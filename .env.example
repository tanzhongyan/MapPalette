# MapPaletteV2 Environment Variables
# This file is a merged version of the original project's .env.example and the official Supabase docker self-hosting .env.example.
# Copy this file to .env and fill in your values.

# =============================================================
# SECTION 1: CRITICAL SECRETS (CHANGE THESE FOR PRODUCTION)
# =============================================================

# PostgreSQL password
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password

# Supabase JWT secret (at least 32 characters long)
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# Supabase anonymous and service role keys (do not need to be changed for local dev)
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q

# Supabase Studio dashboard credentials
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated

# Additional Supabase secrets
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq
VAULT_ENC_KEY=your-encryption-key-32-chars-min
PG_META_CRYPTO_KEY=your-encryption-key-32-chars-min

# Internal service-to-service authentication key
INTERNAL_SERVICE_KEY=change-me-to-a-random-string-use-openssl-rand-hex-32

# ===================================
# SECTION 2: DATABASE CONFIGURATION
# ===================================

# PostgreSQL connection details
POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432
# Default PostgreSQL user is 'postgres'

# Prisma connection strings for backend services (includes connection pooling)
DATABASE_URL=postgresql://postgres:your-super-secret-and-long-postgres-password@db:5432/postgres?schema=public&connection_limit=10&pool_timeout=10
DIRECT_URL=postgresql://postgres:your-super-secret-and-long-postgres-password@db:5432/postgres?schema=public

# Supavisor (database pooler) configuration
POOLER_PROXY_PORT_TRANSACTION=6543
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100
POOLER_TENANT_ID=your-tenant-id
POOLER_DB_POOL_SIZE=5

# PostgREST configuration
PGRST_DB_SCHEMAS=public,storage,graphql_public

# ======================================
# SECTION 3: AUTHENTICATION (GOTRUE)
# ======================================

# General Auth settings
SITE_URL=http://localhost:3000
ADDITIONAL_REDIRECT_URLS=http://localhost:3000/*,http://localhost/*
JWT_EXPIRY=3600
DISABLE_SIGNUP=false
API_EXTERNAL_URL=http://localhost:8000

# SUPABASE_PUBLIC_URL: The URL that frontend clients use to access Supabase
#   - DEVELOPMENT: Use http://localhost:8000 (direct to Kong gateway)
#   - PRODUCTION: Use your domain, e.g., https://api.yourdomain.com or https://yourdomain.com
SUPABASE_PUBLIC_URL=http://localhost:8000

# Email authentication
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=true # Set to true to bypass email confirmation for local dev

# Phone authentication
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=true

# Anonymous users
ENABLE_ANONYMOUS_USERS=false

# SMTP settings for Supabase GoTrue (Resend - https://resend.com)
# For testing: use onboarding@resend.dev (only sends to your Resend signup email)
# For production: verify your domain in Resend and use noreply@yourdomain.com
SMTP_ADMIN_EMAIL=onboarding@resend.dev
SMTP_HOST=smtp.resend.com
SMTP_PORT=465
SMTP_USER=resend
SMTP_PASS=re_YOUR_API_KEY_HERE
SMTP_SENDER_NAME=MapPalette

# URL paths for auth emails (used by GoTrue)
MAILER_URLPATHS_CONFIRMATION="/auth/v1/verify"
MAILER_URLPATHS_INVITE="/auth/v1/verify"
MAILER_URLPATHS_RECOVERY="/auth/v1/verify"
MAILER_URLPATHS_EMAIL_CHANGE="/auth/v1/verify"

# ===============================
# SECTION 4: GATEWAY & SERVICES
# ===============================

# Kong API Gateway ports
KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443

# Redis
REDIS_URL=redis://redis:6379
REDIS_PORT=6379

# Backend Microservice Ports
USER_SERVICE_PORT=3001
POST_SERVICE_PORT=3002
INTERACTION_SERVICE_PORT=3003
FEED_SERVICE_PORT=3004
SOCIAL_INTERACTION_SERVICE_PORT=3005
PROFILE_SERVICE_PORT=3006
FOLLOW_SERVICE_PORT=3007
EXPLORE_ROUTES_SERVICE_PORT=3008
LEADERBOARD_SERVICE_PORT=3009
USER_DISCOVERY_SERVICE_PORT=3010

# Backend Service-to-Service Communication URLs
# IMPORTANT: For Docker deployments, use Docker network service names
# Format: http://<service-name>:<port>/<api-path>
# For local dev outside Docker, use http://localhost:<port>/<api-path>
USER_SERVICE_URL=http://user-service:3001
POST_SERVICE_URL=http://post-service:3002
INTERACTION_SERVICE_URL=http://interaction-service:3003
FEED_SERVICE_URL=http://feed-service:3004
SOCIAL_INTERACTION_SERVICE_URL=http://social-interaction-service:3005
PROFILE_SERVICE_URL=http://profile-service:3006
FOLLOW_SERVICE_URL=http://follow-service:3007
EXPLORE_ROUTES_SERVICE_URL=http://explore-routes-service:3008
LEADERBOARD_SERVICE_URL=http://leaderboard-service:3009
USER_DISCOVERY_SERVICE_URL=http://user-discovery-service:3010

# Supabase Storage port
STORAGE_PORT=5000

# Supabase Functions
FUNCTIONS_VERIFY_JWT=false

# Image Proxy (Imgproxy)
IMGPROXY_ENABLE_WEBP_DETECTION=true

# =========================================
# SECTION 5: FRONTEND & CLIENT-SIDE VARS
# =========================================

# Frontend port
FRONTEND_PORT=3000

# Vite variables passed to the frontend application
VITE_API_URL=http://localhost
VITE_SUPABASE_URL=http://localhost:8000
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE

# VITE_ variables for backend microservice URLs (exposed to browser)
# These should point to the Kong gateway, which routes to the backend services
# DEVELOPMENT: http://localhost:8000 (Kong gateway)
# PRODUCTION: https://api.yourdomain.com or https://yourdomain.com
VITE_USER_SERVICE_URL=http://localhost:8000
VITE_POST_SERVICE_URL=http://localhost:8000
VITE_INTERACTION_SERVICE_URL=http://localhost:8000
VITE_FOLLOW_SERVICE_URL=http://localhost:8000
VITE_SOCIAL_INTERACTION_URL=http://localhost:8000
VITE_EXPLORE_ROUTES_URL=http://localhost:8000

# Google Maps API (required for frontend map functionality)
# Note: Backend services use GOOGLE_MAPS_* variables
# Frontend (Vite) requires VITE_GOOGLE_MAPS_* prefix to expose to browser
GOOGLE_MAPS_API_KEY=your-google-maps-api-key-here
GOOGLE_MAPS_MAP_ID=your-google-maps-map-id-here
VITE_GOOGLE_MAPS_API_KEY=your-google-maps-api-key-here
VITE_GOOGLE_MAPS_MAP_ID=your-google-maps-map-id-here

# =======================================
# SECTION 6: DEVELOPMENT & ENVIRONMENT
# =======================================

# NODE_ENV: Set based on your environment
#   - development: For local development (disables HTTPS redirects, allows localhost)
#   - production: For production (enforces HTTPS, requires valid domain)
NODE_ENV=development

# DOMAIN: Used by Caddy reverse proxy and Auth configuration
#   - LOCAL DEVELOPMENT: Leave unset or set to empty string "" (Caddy will use :80 only)
#   - PRODUCTION: Set to your domain, e.g., "mappalette.com" (Caddy will use https://{DOMAIN})
# IMPORTANT: Setting DOMAIN=localhost will cause issues. Leave empty for local dev.
DOMAIN=

# Supabase Studio configuration
STUDIO_DEFAULT_ORGANIZATION="Default Organization"
STUDIO_DEFAULT_PROJECT="Default Project"
# OpenAI API Key for Studio SQL Editor Assistant (optional)
OPENAI_API_KEY=

# =======================================
# SECTION 7: LOGS & ANALYTICS
# =======================================

# Logflare (optional, for analytics)
LOGFLARE_PUBLIC_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-public
LOGFLARE_PRIVATE_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-private

# Docker socket location (value may differ based on your OS)
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# Google Cloud Project details (for analytics)
GOOGLE_PROJECT_ID=GOOGLE_PROJECT_ID
GOOGLE_PROJECT_NUMBER=GOOGLE_PROJECT_NUMBER